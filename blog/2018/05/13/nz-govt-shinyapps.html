      <!DOCTYPE html>
	<html lang="en">
		<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
			<title>Fifteen New Zealand government Shiny web apps</title>
      	
         
         
            <meta name ="description" content ="I had a brief look around New Zealand government agency websites and found 15 high quality web apps written in the Shiny platform.">
            <meta property="og:description" content ="I had a brief look around New Zealand government agency websites and found 15 high quality web apps written in the Shiny platform.">
         
         <meta property="og:site_name" content="free range statistics" />
         <meta property="og:title" content="Fifteen New Zealand government Shiny web apps" />
         
            <meta property="og:image" content="http://freerangestats.info/img/0122-treasury-insights-small.gif" />
         
		 
			<meta property="og:url" content="http://freerangestats.info/blog/2018/05/13/nz-govt-shinyapps.html" />
		 
         <meta property="og:author" content= "https://www.facebook.com/peterstats" />
         <meta property="og:type" content="article" />
      

<link href='https://fonts.googleapis.com/css?family=Sarala' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Prosto+One' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet'>
	  
          <link href="/css/bootstrap.min.css" rel ="stylesheet" type="text/css">
          <link href="/css/bootstrap-theme.min.css" rel ="stylesheet" type="text/css">
            <link href="/css/custom.css" rel ="stylesheet" type="text/css">     
		<link href="/css/syntax.css" rel ="stylesheet" type="text/css">     			
                 
            
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-65886313-1', 'auto');
     ga('send', 'pageview');

   </script>
   
   <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

   <style>
    ul li { margin-bottom: 9px; }
    ol li { margin-bottom: 9px; }
   </style>
   
   <link rel="alternate" type="application/rss+xml" title="free range statistics by Peter Ellis"
      href="/feed.xml">

	  

      
		</head>
      
  <body role = "document">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        
		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
  
  <script>
  (function() {
    var cx = '015640467633673901770:pk3v2c95baw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>

  
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">free range statistics</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/about">about</a></li>
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">all posts <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/blog">ordered by date</a></li>
				  <li><a href="/blog/most-popular.html">ordered by popularity</a></li>
                  <li><a href="/blog/index_by_tag.html">grouped by subject matter</a></li>
                  <li><a href="/blog/nz.html">all posts with data about new zealand</a></li>
				  <li><a href="/blog/voting.html">all posts on voting behaviour</a></li>
				  <li><a href = /blog/2018/05/13/nz-govt-shinyapps>most recent post</a></li>
				</ul>
            </li>
              <li><a href="/blog/showcase.html">showcase</a></li>
              <li><a href="/presentations/index.html">presentations</a></li>
			  <li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">nz election forecasts<span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href = "/elections/combined.html">combined model (recommended)</a></li>
                  <li><a href="https://ellisp.shinyapps.io/nz-election-2017/">explore coalitions and assumptions</a></li>
				  <li><a href="/elections/elections.html">model A "generalized additive model"</a></li>
				  <li><a href = "/elections/state-space.html">model B "state space"</a></li>
				  <li><a href="/elections/changelog.html">log of changes to forecasts</a></li>
				  <li><a href="https://github.com/ellisp/nz-election-forecast">source code on GitHub</a></li>
				  <li><a href="/blog/voting.html">all posts on voting behaviour</a></li>
                </ul>				
			  </li>
			  
			  
			  
		    </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  
  
      
			<div class="container">
			
			<div class="container">     
      <div class="jumbotron">
      <div class="container">
        <h1>Fifteen New Zealand government Shiny web apps</h1>
         
      </div>
    </div>
</div>
      
<div class="container">
<div class="col-md-2"></div>
  <div class="col-md-8">
		<div>
         <style>
table, td, th {
    border: 3px solid white;
	border-collapse:separate;
    border-spacing:0 5px;
}

img {
	width: 100%;
}
</style>

<h2>At a glance:</h2>
<p>I had a brief look around New Zealand government agency websites and found 15 high quality web apps written in the Shiny platform.</p>
<p class="meta">13 May 2018</p>
<hr />

<p>Here’s fifteen nice web applications built with RStudio’s Shiny framework.  All of these are owned and maintained by New Zealand government departments and have a main purpose as making public data more available and accessible for non-specialist users.  I think it’s fair to say New Zealand has been a leader in using Shiny for this.</p>

<p>As a commissioner of several of those below and author of one, I can say the appeal of Shiny for this sort of public dissemination of data is the combination of <em>cheap</em>, <em>quick</em> and <em>pretty good</em>.  It’s rare to have so little trade-off between those three items of the project management dilemma.  Usually it’s “cheap, quick, good - pick any two”.</p>

<p>The modest trade-off in my view is in some small aspects of the eventual quality and performance.  The server-client transfers can seem clunky (certainly compared to something written in pure JavaScript), particularly when you’re at the bottom of the world using a server in the USA.  They have an annoying habit of freezing and going grey on your users if something goes wrong with the connection.  And as they get more complicated, you start using more JavaScript, HTML and CSS anyway.  But the results are 80% or 90% good enough for many use cases, and development and deployment costs are materially less than other options.  I find Shiny more flexible, powerful and controllable (eg fonts, polish, etc which can all be done with CSS) than Tableau or Power BI, and cheaper and quicker than writing your own app from the ground up.</p>

<p>So, go Shiny!</p>

<h3 id="ministry-of-business-innovation-and-employment">Ministry of Business, Innovation and Employment</h3>

<table>

<tr><td>I'm pretty sure the New Zealand Tourism Forecasts was the first use of Shiny by a government agency in New Zealand.  My old team produced this tool in 2015.  It's nice and simple, not particularly ambitious, but it does the job of letting the user play around with the forecasts much more effectively and better presented than previous dissemination methods (ie Excel pivot tables, if you were lucky).</td><td width="350px"><img src="/img/0122-tourism-forecasts-small.gif" /></td></tr>

<tr><td>The <a href="http://tourismdashboard.mbie.govt.nz/">New Zealand Tourism Dashboard</a> was our first ambitious big Shiny project.  A brilliant job by Jimmy Oh, first of his sequence of high quality boundary-pushing apps for MBIE.  It combines data from MBIE itself, Stats NZ, and direct from the web.  The <a href="https://github.com/nz-mbie/tourism-dashboard-public">source code is on GitHub</a>.</td><td width="350px"><img src="/img/0122-tourism-dashboard-small.gif" /></td></tr>

<tr><td>Building on the style of the tourism dashboard came the <a href="http://sectorsdashboard.mbie.govt.nz/">New Zealand Sectors Dashboard</a>.  It aims to be a one-stop shop for all information about New Zealand's economy by sectors. It brings together a range of economic datasets produced by MBIE and Statistics New Zealand into one easy-to-use tool. </td><td width="250px"><img src="/img/0122-sectors-dashboard-small.gif" /></td></tr>

<tr><td>And the <a href="https://mbienz.shinyapps.io/labour-market-dashboard_prod/">New Zealand Labour Market Dashboard</a>.  It displays labour market information from many different sources in one place.</td><td width="250px"><img src="/img/0122-labour-dashboard-small.gif" /></td></tr>

<tr><td>The <a href="https://mbienz.shinyapps.io/urban-development-capacity/">Urban Development Capacity Dashboard</a>, jointly branded by MBIE and the Ministry for the Environment, provides charts, maps, tables and underlying data on local markets for housing and business space.</td><td width="250px"><img src="/img/0122-urban-dashboard-small.gif" /></td></tr>

<tr><td>The <a href="https://mbienz.shinyapps.io/mtagdp/">Modelled Territorial Authority GDP</a> is the only Shiny app on this page I can claim to have authored personally.  It was the tail end (dissemination) of a big project producing new granular estimates of value add by industry, district and city.  There is a paper and presentation on this on the <a href="/presentations/index.html">presentations part of my website</a> and <a href="https://github.com/nz-mbie/MTAGDP">source code for the app, and the much bigger job of creating the data, is on GitHub</a>.</td><td width="250px"><img src="/img/0122-mtagdp-small.gif" /></td></tr>

 </table>

<h3 id="stats-nz">Stats NZ</h3>

<table>

<tr><td>The <a href="https://statisticsnz.shinyapps.io/livingcostsexplorer/">Living Cost Explorer</a> presents data from Household Living-costs Price Indexes.  It shows how price changes vary depending upon the average basket of goods of different types of people, such as beneficiaries, Māori and superannuitants.</td><td width="350px"><img src="/img/0122-livingcost-small.gif" /></td></tr>

<tr><td><a href="https://statisticsnz.shinyapps.io/irrigated_land/">Irrigated land in New Zealand</a> uses maps and graphs to present spatial information on irrigation of New Zealand land.</td><td width="350px"><img src="/img/0122-irrigation-small.gif" /></td></tr>

<tr><td>This <a href="https://statisticsnz.shinyapps.io/landcover/">Landcover</a> tool shows composition and changes in land cover.</td><td width="250px"><img src="/img/0122-landcover-small.gif" /></td></tr>

<tr><td>The third of these spatial / environmentally themed tools, <a href="https://statisticsnz.shinyapps.io/livestock_update/">Livestock numbers</a> has graphs and maps showing the distribution of cattle (different types thereof), sheep and deer.</td><td width="250px"><img src="/img/0122-livestock-small.gif" /></td></tr>

<tr><td>The <a href="https://shinyapps.stats.govt.nz/tkpie/">Iwi cultural well-being from Te Kupenga 2013</a> app may be the first Shiny app with an option to swap the user interface into Te reo Māori.</td><td width="250px"><img src="/img/0122-tkpie-small.gif" /></td></tr>

<tr><td>This series of <a href="http://innovation.stats.govt.nz/initiatives/experimental-estimates-of-income-from-linked-administrative-data-methods-and-results/">Experimental estimates of income</a> has been derived from the tax data available in the Integrated Data Infrastructure as part of ongoing work at Stats NZ to increase the use of administrative data in the production of statistics.</td><td width="250px"><img src="/img/0122-income-small.gif" /></td></tr>

 </table>

<h3 id="ministry-of-health">Ministry of Health</h3>

<table>

<tr><td> An interactive tool for exploring <a href="https://minhealthnz.shinyapps.io/nz-health-survey-2016-17-annual-data-explorer/">New Zealand Health Survey data</a>.It presents the latest results by sex, age, ethnic group and neighbourhood deprivation, as well as changes over time.</td><td width="350px"><img src="/img/0122-nzhs-small.gif" /></td></tr>

<tr><td>A tool to allow <a href="https://minhealthnz.shinyapps.io/datapharm-beta/"> summary data about prescriptions and dispensings</a> funded by the New Zealand Government.</td><td width="350px"><img src="/img/0122-datapharm-small.gif" /></td></tr>

 </table>

<h3 id="treasury">Treasury</h3>

<table>

<tr><td>Treasury's <a href="https://insights.apps.treasury.govt.nz/">Insights</a> tool provides information drawn from a range of public sector agencies including extensive use of the Integrated Data Infrastructure.</td><td width="350px"><img src="/img/0122-treasury-insights-small.gif" /></td></tr>

 </table>

<p>Nice collection.  Anyone know of any others?</p>

<p><b>Disclaimer:</b> I was part of the commissioning team for several of the MBIE Shiny apps, and (as noted above) the author of one.  I haven’t been involved in development of any of the others listed above.</p>

<h3 id="making-animated-gifs-of-websites">Making animated GIFs of websites</h3>

<p>To make the animated GIFs used in this website and keep them to a reasonable size (under 10MB each), here’s what I did.</p>

<ul>
  <li>I did the original screen captures using the open source <a href="http://camstudio.org/">CamStudio</a> application and saved them as .avi files.   Even though only a part of my screen was captured, with the original screen resolution and about 30 - 45 seconds of content, these files were large; typically 700MB or larger.</li>
  <li>I used a <a href="https://gist.github.com/michaelosthege/cd3e0c3c556b70a79deba6855deb2cc8">Python program</a> that GitHub user michaelosthege had published as a Gist to convert from .avi to .gif format.  These were about a quarter or fifth the size, but still too large (150MB - 200MB) to use on the web</li>
  <li>I found another <a href="https://gist.github.com/PaulineLc/46bb8ddec8a1c3279c24482ae48a1e06">Python program</a> by PaulineLc on another Gist that shrank and sped up animated GIFs.</li>
</ul>

<p>Is it ironic that a blog post celebrating R Shiny used Python for playing around with the animated images?  I don’t think so at all; it’s just a matter of using the convenient and easy tool for the job at hand.  Python is awesome with everything to do with images; There are ways in R to do this too (or they could certainly be developed) but it was easier to find out how to do it in Python.  I am not as good with Python as with R, but I know how to copy and paste a program someone else has written when it does exactly what I need!</p>

<p>In case the gist every disappears, here’s the <code class="highlighter-rouge">convert_movie()</code> function for converting movie formats:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># https://gist.github.com/michaelosthege/cd3e0c3c556b70a79deba6855deb2cc8</span>
<span class="c"># by michaelosthege, just renamed to convert_movie by ellisp otherwise unchanged</span>

<span class="kn">import</span> <span class="nn">imageio</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>


<span class="k">class</span> <span class="nc">TargetFormat</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">GIF</span> <span class="o">=</span> <span class="s">".gif"</span>
    <span class="n">MP4</span> <span class="o">=</span> <span class="s">".mp4"</span>
    <span class="n">AVI</span> <span class="o">=</span> <span class="s">".avi"</span>

<span class="k">def</span> <span class="nf">convert_movie</span><span class="p">(</span><span class="n">inputpath</span><span class="p">,</span> <span class="n">targetFormat</span><span class="p">):</span>
    <span class="s">"""Reference: http://imageio.readthedocs.io/en/latest/examples.html#convert-a-movie"""</span>
    <span class="n">outputpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">inputpath</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">targetFormat</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"converting</span><span class="se">\r\n\t</span><span class="s">{0}</span><span class="se">\r\n</span><span class="s">to</span><span class="se">\r\n\t</span><span class="s">{1}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inputpath</span><span class="p">,</span> <span class="n">outputpath</span><span class="p">))</span>

    <span class="n">reader</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">get_reader</span><span class="p">(</span><span class="n">inputpath</span><span class="p">)</span>
    <span class="n">fps</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">get_meta_data</span><span class="p">()[</span><span class="s">'fps'</span><span class="p">]</span>

    <span class="n">writer</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">get_writer</span><span class="p">(</span><span class="n">outputpath</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">im</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reader</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">"</span><span class="se">\r</span><span class="s">frame {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">append_data</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\r\n</span><span class="s">Finalizing..."</span><span class="p">)</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Done."</span><span class="p">)</span></code></pre></figure>

<p>And here’s the <code class="highlighter-rouge">resize_gif()</code> function (plus helpers) for resizing them:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># https://gist.github.com/PaulineLc/46bb8ddec8a1c3279c24482ae48a1e06</span>
<span class="c"># by PaulineLc, completely unchanged by ellisp</span>

<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="s">'''
Based on a script by BigglesZX: https://gist.github.com/BigglesZX/4016539
BigglesZX was adapted as follows:
    - Updated to be compatible with Python 3.
    - The original function 'processImage' was renamed 'extract_and_resize_frames' and was adapted as follows:
        - It resizes each frames as it extracts them
        - It saves all the frames to an array
        - It returns the array of all frames
    - a function 'resize_gif' was added which calls 'extract_and_resize_frames' to extract all the GIF frames and then
      saves all frames to an output file.
    - the function main() was modified to call 'resize_gif'
Functionality of the current script:
    - Similar functionality to BigglesZX's original script
    - Extracts all frames from a GIF and returns as array of all frames
    - Resizes the GIF to a given size
JAN 2017
'''</span>


<span class="k">def</span> <span class="nf">resize_gif</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">save_as</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">resize_to</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="s">"""
    Resizes the GIF to a given length:
    Args:
        path: the path to the GIF file
        save_as (optional): Path of the resized gif. If not set, the original gif will be overwritten.
        resize_to (optional): new size of the gif. Format: (int, int). If not set, the original GIF will be resized to
                              half of its size.
    """</span>
    <span class="n">all_frames</span> <span class="o">=</span> <span class="n">extract_and_resize_frames</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">resize_to</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">save_as</span><span class="p">:</span>
        <span class="n">save_as</span> <span class="o">=</span> <span class="n">path</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_frames</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Warning: only 1 frame found"</span><span class="p">)</span>
        <span class="n">all_frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">save_as</span><span class="p">,</span> <span class="n">optimize</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">all_frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">save_as</span><span class="p">,</span> <span class="n">optimize</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">save_all</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">append_images</span><span class="o">=</span><span class="n">all_frames</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">loop</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">analyseImage</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="s">"""
    Pre-process pass over the image to determine the mode (full or additive).
    Necessary as assessing single frames isn't reliable. Need to know the mode
    before processing all frames.
    """</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'size'</span><span class="p">:</span> <span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
        <span class="s">'mode'</span><span class="p">:</span> <span class="s">'full'</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">im</span><span class="o">.</span><span class="n">tile</span><span class="p">:</span>
                <span class="n">tile</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">tile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">update_region</span> <span class="o">=</span> <span class="n">tile</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">update_region_dimensions</span> <span class="o">=</span> <span class="n">update_region</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="k">if</span> <span class="n">update_region_dimensions</span> <span class="o">!=</span> <span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                    <span class="n">results</span><span class="p">[</span><span class="s">'mode'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'partial'</span>
                    <span class="k">break</span>
            <span class="n">im</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">EOFError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">results</span>


<span class="k">def</span> <span class="nf">extract_and_resize_frames</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">resize_to</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="s">"""
    Iterate the GIF, extracting each frame and resizing them
    Returns:
        An array of all frames
    """</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="n">analyseImage</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="s">'mode'</span><span class="p">]</span>

    <span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">resize_to</span><span class="p">:</span>
        <span class="n">resize_to</span> <span class="o">=</span> <span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">getpalette</span><span class="p">()</span>
    <span class="n">last_frame</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s">'RGBA'</span><span class="p">)</span>

    <span class="n">all_frames</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="c"># print("saving %s (%s) frame %d, %s %s" % (path, mode, i, im.size, im.tile))</span>

            <span class="s">'''
            If the GIF uses local colour tables, each frame will have its own palette.
            If not, we need to apply the global palette to the new frame.
            '''</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">im</span><span class="o">.</span><span class="n">getpalette</span><span class="p">():</span>
                <span class="n">im</span><span class="o">.</span><span class="n">putpalette</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

            <span class="n">new_frame</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s">'RGBA'</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

            <span class="s">'''
            Is this file a "partial"-mode GIF where frames update a region of a different size to the entire image?
            If so, we need to construct the new frame by pasting it on top of the preceding frames.
            '''</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">'partial'</span><span class="p">:</span>
                <span class="n">new_frame</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">last_frame</span><span class="p">)</span>

            <span class="n">new_frame</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">im</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s">'RGBA'</span><span class="p">))</span>

            <span class="n">new_frame</span><span class="o">.</span><span class="n">thumbnail</span><span class="p">(</span><span class="n">resize_to</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">ANTIALIAS</span><span class="p">)</span>
            <span class="n">all_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_frame</span><span class="p">)</span>

            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">last_frame</span> <span class="o">=</span> <span class="n">new_frame</span>
            <span class="n">im</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">EOFError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="n">all_frames</span></code></pre></figure>

<p>Usage is simple; assuming Python is working in a directory with the AVI movie <code class="highlighter-rouge">0122-mtagdp.avi</code>, the code below first creates <code class="highlighter-rouge">0122-mtagdp.gif</code> then shrinks it to <code class="highlighter-rouge">0122-mtagdp-small.gif</code>:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">convert_movie</span><span class="p">(</span><span class="s">"0122-mtagdp.avi"</span><span class="p">,</span> <span class="n">TargetFormat</span><span class="o">.</span><span class="n">GIF</span><span class="p">)</span>
<span class="n">resize_gif</span><span class="p">(</span><span class="s">'0122-mtagdp.gif'</span><span class="p">,</span> <span class="n">save_as</span><span class="o">=</span><span class="s">'0122-mtagdp-small.gif'</span><span class="p">)</span></code></pre></figure>


        </div>
         
	</div>
</div>
	  
	<div>
	   
	    
			
			<p>&larr; Previous post</p>
			<p><a rel="prev" href="/blog/2018/05/05/survey-books-and-courses">Survey books, courses and tools</a></p>
		
		
		
		
		
		
	</div>
	  
	           
<div id="disqus_thread"></div>

    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'statsinthewild';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'statsinthewild';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>  

	  


         

			
			</div>

         

   <div class = "container footer">
			<footer>
	    		<gcse:search></gcse:search>
        	<p>Follow <a href = "/feed.xml">this blog with RSS</a>.</p>
			
            <p>I'm pleased to be aggregated at <a href="http://www.r-bloggers.com/">R-bloggers</a>, the one-stop shop for blog posts featuring R.</p>

			<div class="fb-like" data-href="https://www.facebook.com/peterstats/" data-layout="standard" data-action="like" data-show-faces="true" data-share="false"></div>
			
			<p>			
            <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">free range statistics</span> by <a href = "/about/index.html">Peter Ellis</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
			</p>

			

			</footer>
    </div>


<!-- Default Statcounter code for Free Range Statistics
http://Http://freerangestats.info -->
<script type="text/javascript">
var sc_project=11673245; 
var sc_invisible=1; 
var sc_security="5b7111a4"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js" async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="http://statcounter.com/" target="_blank"><img class="statcounter"
src="//c.statcounter.com/11673245/0/5b7111a4/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of Statcounter Code -->

  
</body>
</html>
   




         
