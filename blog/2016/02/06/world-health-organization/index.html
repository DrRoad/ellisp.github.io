      <!DOCTYPE html>
	<html lang="en">
		<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
			<title>Data from the World Health Organization API</title>
      	
         
         
            <meta name ="description" content ="Eric Persson's new WHO package makes it easy for R users to access data from the World Health Organization">
            <meta property="og:description" content ="Eric Persson's new WHO package makes it easy for R users to access data from the World Health Organization">
         
         <meta property="og:site_name" content="Peter's stats stuff" />
         <meta property="og:title" content="Data from the World Health Organization API" />
         
            <meta property="og:image" content="http://ellisp.github.io/img/0029-scatter.png" />
         
         <meta property="og:url" content="http://ellisp.github.io/blog/2016/02/06/world-health-organization/" />
         <meta property="og:author" content= "https://www.facebook.com/peter.ellis.353" />
         <meta property="og:type" content="article" />
           
          <link href="/css/bootstrap.min.css" rel ="stylesheet">
          <link href="/css/bootstrap-theme.min.css" rel ="stylesheet">
            <link href="/css/custom.css" rel ="stylesheet">       
     <link rel="stylesheet" href="/css/Pygments/autumn.css">      
     <link rel="stylesheet" href="/css/Pygments/custom.css">      
            
            
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-65886313-1', 'auto');
     ga('send', 'pageview');

   </script>

   <style>
    ul li { margin-bottom: 9px; }
    ol li { margin-bottom: 9px; }
   </style>
   
   <link rel="alternate" type="application/rss+xml" title="Peter's stats stuff by Peter Ellis"
      href="/feed.xml">


      
		</head>
      
  <body role = "document">
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
         <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
         <script src="/js/bootstrap.min.js"></script>
         
  
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Peter's stats stuff</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="/">Home</a></li>
            <li><a href="/about">About</a></li>
            <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">All blog posts <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="/blog">Ordered by date</a></li>
                  <li><a href="/blog/index_by_tag.html">Grouped by subject matter</a></li>
                  <li><a href = /blog/2016/04/16/nzelect4>Most recent post</a></li>
                 </ul>
            </li>
              <li><a href="/blog/showcase.html">Showcase</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  
  
      
			<div class="container">
			
			    <div class="jumbotron">
      <div class="container">
        <h1>Data from the World Health Organization API</h1>
         <p class="meta">06 Feb 2016</p>
        
      </div>
    </div>




<div class = "post-summary">
<h2>TL;DR Summary:</h2>
   Eric Persson's new WHO package makes it easy for R users to access data from the World Health Organization
   <hr></hr>
</div>

<div class="post">
<div class="col-md-2">

</div>
  <div class="col-md-8">

  <p>Eric Persson released yesterday a new <a href="https://cran.r-project.org/web/packages/WHO/index.html"><code>WHO</code> R package</a> which allows easy access to the <a href="http://www.who.int">World Health Organization</a>’s data API.  He’s also done a <a href="https://cran.r-project.org/web/packages/WHO/vignettes/who_vignette.html">nice vignette</a> introducing its use.</p>

<p>I had a play and found it was easy access to some interesting data.  Some time down the track I might do a comparison of this with other sources, the most obvious being the World Bank’s World Development Indicators, to identify relative advantages - there’s a lot of duplication of course.  It’s a nice problem to have, too much data that’s too easy to get hold of.  I wish we’d had that problem when I studied aid and development last century - I vividly remember re-keying numbers from almanac-like hard copy publications, and pleased we were to have them too!</p>

<p>Here’s a plot showing country-level relationships between the latest data of three indicators - access to contraception, adolescent fertility, and infant mortality - that help track the Millennium Development Goals.</p>
<iframe src="/img/0029-scatter.html" style="overflow-y: hidden;" width="800px" height="650px"></iframe>

<p>Note that there’s some micro-interactivity here - you can move the labels around, zoom in on a part of the plot, or reposition the whole thing.  It’s easier to explore in the <a href="/img/0029-scatter.html">full screen version</a>.  Thanks to <a href="https://github.com/juba/scatterD3">Julien Barnier’s <code>scatterD3</code></a> R package for making this JavaScript D3 functionality easily available from R.</p>

<p>Here are the exploratory plots I made on the way to that.  All the code is reproduced at the bottom of the post.</p>

<p>Infant mortality has been increasing steadily since 1990 when these data start, and in fact from decades before too.  Sad blip in Haiti from the 2010 earthquake:
<img src="/img/0029-mdg1.svg" alt="MDG1" /></p>

<p>The data on adolescent fertility is surprisingly sparse, with only one data point per country and many of them quite old.  While Africa is often in a class of its own on development indicators, this graphic might surprise people in showing how much teen pregnancy is such an issue in Africa (note that the inclusion of Sudan and Somalia in “Eastern Mediterranean” region wasn’t done by me):
<img src="/img/0029-mdg3.svg" alt="MDG3" /></p>

<p>Data on contraception use is also sparse; mostly one data point per country, but a few have two.  There’s not much that stands out here other than the high usage in the wealthier countries of Europe (the blue ones) and low in the poor countries of Africa (red). 
<img src="/img/0029-mdg5.svg" alt="MDG5" /></p>

<p>Here’s the R code that did that.  Hopefully other people will pick up on this - good work from the WHO for their database and API, and Eric Persson for making it easy to access from R.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><a name="True-1"></a><span class="c1"># basic functionality</span>
<a name="True-2"></a><span class="kn">library</span><span class="p">(</span>WHO<span class="p">)</span>
<a name="True-3"></a><span class="kn">library</span><span class="p">(</span>dplyr<span class="p">)</span>
<a name="True-4"></a><span class="kn">library</span><span class="p">(</span>ggplot2<span class="p">)</span>
<a name="True-5"></a><span class="kn">library</span><span class="p">(</span>scales<span class="p">)</span>
<a name="True-6"></a><span class="kn">library</span><span class="p">(</span>showtext<span class="p">)</span>
<a name="True-7"></a><span class="kn">library</span><span class="p">(</span>scatterD3<span class="p">)</span> <span class="c1"># note - this is the GitHub version so we have ellipses</span>
<a name="True-8"></a><span class="kn">library</span><span class="p">(</span>stringr<span class="p">)</span>
<a name="True-9"></a><span class="kn">library</span><span class="p">(</span>RColorBrewer<span class="p">)</span>
<a name="True-10"></a><span class="kn">library</span><span class="p">(</span>dygraphs<span class="p">)</span>
<a name="True-11"></a>
<a name="True-12"></a><span class="c1"># ---------------default fonts, themes and colour scale</span>
<a name="True-13"></a>font.add.google<span class="p">(</span><span class="s">&quot;Poppins&quot;</span><span class="p">,</span> <span class="s">&quot;myfont&quot;</span><span class="p">)</span>
<a name="True-14"></a>showtext.auto<span class="p">()</span>
<a name="True-15"></a>
<a name="True-16"></a>
<a name="True-17"></a>mdg_theme <span class="o">&lt;-</span> theme_light<span class="p">(</span>base_family <span class="o">=</span> <span class="s">&quot;myfont&quot;</span><span class="p">)</span> <span class="o">+</span> theme<span class="p">(</span>legend.position <span class="o">=</span> <span class="s">&quot;bottom&quot;</span><span class="p">)</span>
<a name="True-18"></a>theme_set<span class="p">(</span>mdg_theme<span class="p">)</span>
<a name="True-19"></a>
<a name="True-20"></a>scale_colour_discrete <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span><span class="kc">...</span><span class="p">)</span> <span class="p">{</span>
<a name="True-21"></a>   scale_colour_manual<span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> values <span class="o">=</span> brewer.pal<span class="p">(</span><span class="m">6</span><span class="p">,</span> <span class="s">&quot;Spectral&quot;</span><span class="p">)[</span><span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">)],</span> <span class="kc">...</span><span class="p">)</span>
<a name="True-22"></a><span class="p">}</span>
<a name="True-23"></a>
<a name="True-24"></a>
<a name="True-25"></a><span class="c1">#------------------data prep-------------</span>
<a name="True-26"></a><span class="c1"># download all WHO codes</span>
<a name="True-27"></a>codes <span class="o">&lt;-</span> get_codes<span class="p">()</span>
<a name="True-28"></a><span class="kp">dim</span><span class="p">(</span>codes<span class="p">)</span> <span class="c1"># 2144 codes</span>
<a name="True-29"></a>
<a name="True-30"></a>
<a name="True-31"></a>mdg_codes <span class="o">&lt;-</span> codes<span class="p">[</span><span class="kp">grepl</span><span class="p">(</span><span class="s">&quot;^MDG&quot;</span><span class="p">,</span> codes<span class="o">$</span>label<span class="p">),</span> <span class="p">]</span>
<a name="True-32"></a>mdg_codes<span class="o">$</span>number <span class="o">&lt;-</span> <span class="kp">as.numeric</span><span class="p">(</span>str_sub<span class="p">(</span>mdg_codes<span class="o">$</span>label<span class="p">,</span> start <span class="o">=</span> <span class="m">-2</span><span class="p">))</span>
<a name="True-33"></a>
<a name="True-34"></a>
<a name="True-35"></a><span class="kp">dim</span><span class="p">(</span>mdg_codes<span class="p">)</span> <span class="c1"># 33 for MDGs</span>
<a name="True-36"></a>mdg_codes<span class="o">$</span>label
<a name="True-37"></a>
<a name="True-38"></a><span class="c1">#----------------helper functions---------------</span>
<a name="True-39"></a>prep <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>data<span class="p">){</span>
<a name="True-40"></a>   <span class="c1"># remove regional groupings, and make income a factor with levels in correct order</span>
<a name="True-41"></a>   data <span class="o">%&gt;%</span>
<a name="True-42"></a>      filter<span class="p">(</span><span class="o">!</span>worldbankincomegroup <span class="o">%in%</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;Global&quot;</span><span class="p">,</span> <span class="s">&quot;NA&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span>
<a name="True-43"></a>      filter<span class="p">(</span><span class="o">!</span><span class="kp">is.na</span><span class="p">(</span>region<span class="p">))</span> <span class="o">%&gt;%</span>
<a name="True-44"></a>      filter<span class="p">(</span><span class="o">!</span><span class="kp">is.na</span><span class="p">(</span>country<span class="p">))</span> <span class="o">%&gt;%</span>
<a name="True-45"></a>      mutate<span class="p">(</span>worldbankincomegroup <span class="o">=</span> <span class="kp">factor</span><span class="p">(</span>worldbankincomegroup<span class="p">,</span>
<a name="True-46"></a>                                           levels <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;Low-income&quot;</span><span class="p">,</span> <span class="s">&quot;Lower-middle-income&quot;</span><span class="p">,</span>
<a name="True-47"></a>                                                      <span class="s">&quot;Upper-middle-income&quot;</span><span class="p">,</span> <span class="s">&quot;High-income&quot;</span><span class="p">)))</span>
<a name="True-48"></a><span class="p">}</span>
<a name="True-49"></a>   
<a name="True-50"></a>
<a name="True-51"></a>latest <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>data<span class="p">,</span> nudge <span class="o">=</span> <span class="m">1</span><span class="p">){</span>
<a name="True-52"></a>   <span class="c1"># return a cut back data frame of just the latest value, useful for geom_text annotations</span>
<a name="True-53"></a>   data <span class="o">%&gt;%</span>
<a name="True-54"></a>      group_by<span class="p">(</span>country<span class="p">)</span> <span class="o">%&gt;%</span>
<a name="True-55"></a>      filter<span class="p">(</span>year <span class="o">==</span> <span class="kp">max</span><span class="p">(</span>year<span class="p">))</span> <span class="o">%&gt;%</span>
<a name="True-56"></a>      mutate<span class="p">(</span>year <span class="o">=</span> year <span class="o">+</span> nudge<span class="p">)</span>
<a name="True-57"></a><span class="p">}</span>
<a name="True-58"></a>
<a name="True-59"></a><span class="c1">#-------------------Infant mortality--------------</span>
<a name="True-60"></a>mdg1 <span class="o">&lt;-</span> get_data<span class="p">(</span><span class="s">&quot;MDG_0000000001&quot;</span><span class="p">)</span>
<a name="True-61"></a><span class="c1"># values are a funny mixture of points and intervals, so we extract just the points:</span>
<a name="True-62"></a>mdg1<span class="o">$</span>value_n <span class="o">&lt;-</span> <span class="kp">as.numeric</span><span class="p">(</span>str_extract<span class="p">(</span>mdg1<span class="o">$</span>value<span class="p">,</span> <span class="s">&quot;[0-9]*\\.[0-9]*&quot;</span><span class="p">))</span>
<a name="True-63"></a>
<a name="True-64"></a>mdg1a <span class="o">&lt;-</span> mdg1 <span class="o">%&gt;%</span> prep<span class="p">()</span>
<a name="True-65"></a>
<a name="True-66"></a>
<a name="True-67"></a>p1 <span class="o">&lt;-</span> mdg1a <span class="o">%&gt;%</span>
<a name="True-68"></a>   ggplot<span class="p">(</span>aes<span class="p">(</span>x <span class="o">=</span> year<span class="p">,</span> y <span class="o">=</span> value_n<span class="p">,</span> colour <span class="o">=</span> worldbankincomegroup<span class="p">,</span> group <span class="o">=</span> country<span class="p">))</span> <span class="o">+</span>
<a name="True-69"></a>   geom_line<span class="p">()</span> <span class="o">+</span> 
<a name="True-70"></a>   facet_wrap<span class="p">(</span><span class="o">~</span>region<span class="p">)</span> <span class="o">+</span>
<a name="True-71"></a>   geom_text<span class="p">(</span>data <span class="o">=</span> latest<span class="p">(</span>mdg1a<span class="p">),</span> aes<span class="p">(</span>label <span class="o">=</span> country<span class="p">),</span> hjust <span class="o">=</span> <span class="m">0</span><span class="p">,</span> size <span class="o">=</span> <span class="m">3</span><span class="p">)</span> <span class="o">+</span>
<a name="True-72"></a>   xlim<span class="p">(</span><span class="m">1990</span><span class="p">,</span> <span class="m">2025</span><span class="p">)</span> <span class="o">+</span>
<a name="True-73"></a>   labs<span class="p">(</span>x <span class="o">=</span> <span class="s">&quot;Year&quot;</span><span class="p">,</span>
<a name="True-74"></a>        y <span class="o">=</span> mdg_codes<span class="p">[</span><span class="m">1</span><span class="p">,</span> <span class="s">&quot;display&quot;</span><span class="p">],</span>
<a name="True-75"></a>        title <span class="o">=</span> <span class="s">&quot;&#39;Reduce child mortality&#39; MDG Indicator 14, infant mortality rate&quot;</span><span class="p">)</span>
<a name="True-76"></a>
<a name="True-77"></a><span class="kp">print</span><span class="p">(</span>p1<span class="p">)</span>
<a name="True-78"></a>
<a name="True-79"></a><span class="c1">#--------------Adolescent fertility----------------</span>
<a name="True-80"></a>mdg3 <span class="o">&lt;-</span> get_data<span class="p">(</span><span class="s">&quot;MDG_0000000003&quot;</span><span class="p">)</span>
<a name="True-81"></a><span class="c1"># This isn&#39;t listed at http://www.unmillenniumproject.org/goals/gti.htm as an MDG indicator,</span>
<a name="True-82"></a><span class="c1"># but according to http://www.wikigender.org/wiki/adolescent-birth-rate/ it&#39;s part of</span>
<a name="True-83"></a><span class="c1"># measuring Goal 5 &quot;Improve Maternal Health&quot;</span>
<a name="True-84"></a>
<a name="True-85"></a>mdg3 <span class="o">%&gt;%</span>
<a name="True-86"></a>   prep<span class="p">()</span> <span class="o">%&gt;%</span>
<a name="True-87"></a>   ggplot<span class="p">(</span>aes<span class="p">(</span>x <span class="o">=</span> year<span class="p">,</span> y <span class="o">=</span> value<span class="p">,</span> label <span class="o">=</span> country<span class="p">,</span> colour <span class="o">=</span> worldbankincomegroup<span class="p">))</span> <span class="o">+</span>
<a name="True-88"></a>   labs<span class="p">(</span>x <span class="o">=</span> <span class="s">&quot;Year of latest data&quot;</span><span class="p">,</span>
<a name="True-89"></a>        y <span class="o">=</span> mdg_codes<span class="p">[</span><span class="m">2</span><span class="p">,</span> <span class="s">&quot;display&quot;</span><span class="p">],</span>
<a name="True-90"></a>        title <span class="o">=</span> <span class="s">&quot;&#39;Improve maternal health&#39; MDG un-numbered indicator, adolescent fertility&quot;</span><span class="p">)</span> <span class="o">+</span>
<a name="True-91"></a>   geom_text<span class="p">()</span> <span class="o">+</span>
<a name="True-92"></a>   facet_wrap<span class="p">(</span><span class="o">~</span>region<span class="p">)</span> <span class="o">+</span>
<a name="True-93"></a>   scale_colour_manual<span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> values <span class="o">=</span> brewer.pal<span class="p">(</span><span class="m">6</span><span class="p">,</span> <span class="s">&quot;Spectral&quot;</span><span class="p">)[</span><span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">)])</span> <span class="o">+</span>
<a name="True-94"></a>   theme<span class="p">(</span>legend.position <span class="o">=</span> <span class="s">&quot;bottom&quot;</span><span class="p">)</span>
<a name="True-95"></a>
<a name="True-96"></a><span class="c1">#----------contraceptive prevalence----------</span>
<a name="True-97"></a>mdg5 <span class="o">&lt;-</span> get_data<span class="p">(</span><span class="s">&quot;MDG_0000000005&quot;</span><span class="p">)</span>
<a name="True-98"></a>
<a name="True-99"></a><span class="c1"># for some odd reason there&#39;s no income group so we make it up:</span>
<a name="True-100"></a>mdg5a <span class="o">&lt;-</span> prep<span class="p">(</span>mdg5<span class="p">)</span> <span class="o">%&gt;%</span>
<a name="True-101"></a>   select<span class="p">(</span><span class="o">-</span>worldbankincomegroup<span class="p">)</span> <span class="o">%&gt;%</span>
<a name="True-102"></a>   left_join<span class="p">(</span><span class="kp">unique</span><span class="p">(</span>mdg1a<span class="p">[</span> <span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;country&quot;</span><span class="p">,</span> <span class="s">&quot;worldbankincomegroup&quot;</span><span class="p">)]))</span>
<a name="True-103"></a>
<a name="True-104"></a>p5 <span class="o">&lt;-</span> mdg5a <span class="o">%&gt;%</span>
<a name="True-105"></a>   prep<span class="p">()</span> <span class="o">%&gt;%</span>
<a name="True-106"></a>   ggplot<span class="p">(</span>aes<span class="p">(</span>x <span class="o">=</span> year<span class="p">,</span> y <span class="o">=</span> value <span class="o">/</span> <span class="m">100</span><span class="p">,</span> group <span class="o">=</span> country<span class="p">,</span> colour <span class="o">=</span> worldbankincomegroup<span class="p">))</span> <span class="o">+</span>
<a name="True-107"></a>   facet_wrap<span class="p">(</span><span class="o">~</span>region<span class="p">)</span> <span class="o">+</span>
<a name="True-108"></a>   scale_y_continuous<span class="p">(</span>mdg_codes<span class="p">[</span><span class="m">3</span><span class="p">,</span> <span class="s">&quot;display&quot;</span><span class="p">],</span> label <span class="o">=</span> percent<span class="p">)</span> <span class="o">+</span>
<a name="True-109"></a>   labs<span class="p">(</span>x <span class="o">=</span> <span class="s">&quot;Year of latest data&quot;</span><span class="p">,</span>
<a name="True-110"></a>        title <span class="o">=</span> <span class="s">&quot;&#39;Combat HIV/AIDS, malaria and other diseases&#39; MDG indicator 19c, contraception prevalence&quot;</span><span class="p">)</span> <span class="o">+</span>
<a name="True-111"></a>   xlim<span class="p">(</span><span class="m">1990</span><span class="p">,</span> <span class="m">2020</span><span class="p">)</span> <span class="o">+</span>
<a name="True-112"></a>   geom_point<span class="p">()</span> <span class="o">+</span>
<a name="True-113"></a>   geom_line<span class="p">()</span> <span class="o">+</span>
<a name="True-114"></a>   geom_text<span class="p">(</span>data <span class="o">=</span> latest<span class="p">(</span>mdg5a<span class="p">,</span> <span class="m">0.3</span><span class="p">),</span> aes<span class="p">(</span>label <span class="o">=</span> country<span class="p">),</span> hjust <span class="o">=</span> <span class="m">0</span><span class="p">,</span> size <span class="o">=</span> <span class="m">3</span><span class="p">)</span>
<a name="True-115"></a>   
<a name="True-116"></a><span class="kp">print</span><span class="p">(</span>p5<span class="p">)</span>
<a name="True-117"></a>
<a name="True-118"></a>
<a name="True-119"></a>
<a name="True-120"></a><span class="c1">#==================scatter plot==================</span>
<a name="True-121"></a><span class="c1"># combine the three datasets into just one and knock out countries with missing values</span>
<a name="True-122"></a>comb <span class="o">&lt;-</span> latest<span class="p">(</span>mdg3<span class="p">)</span> <span class="o">%&gt;%</span>
<a name="True-123"></a>   select<span class="p">(</span>country<span class="p">,</span> region<span class="p">,</span> worldbankincomegroup<span class="p">,</span> value<span class="p">)</span> <span class="o">%&gt;%</span>
<a name="True-124"></a>   rename<span class="p">(</span>AdolFert <span class="o">=</span> value<span class="p">)</span> <span class="o">%&gt;%</span>
<a name="True-125"></a>   left_join<span class="p">(</span>latest<span class="p">(</span>mdg5<span class="p">)[,</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;country&quot;</span><span class="p">,</span> <span class="s">&quot;value&quot;</span><span class="p">)],</span> by <span class="o">=</span> <span class="s">&quot;country&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
<a name="True-126"></a>   rename<span class="p">(</span>Contra <span class="o">=</span> value<span class="p">)</span> <span class="o">%&gt;%</span>
<a name="True-127"></a>   left_join<span class="p">(</span>latest<span class="p">(</span>mdg1<span class="p">)[</span> <span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;country&quot;</span><span class="p">,</span> <span class="s">&quot;value_n&quot;</span><span class="p">)],</span> by <span class="o">=</span> <span class="s">&quot;country&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
<a name="True-128"></a>   rename<span class="p">(</span>InfantMortality <span class="o">=</span> value_n<span class="p">)</span> <span class="o">%&gt;%</span>
<a name="True-129"></a>   filter<span class="p">(</span><span class="o">!</span><span class="kp">is.na</span><span class="p">(</span>country<span class="p">))</span> <span class="o">%&gt;%</span>
<a name="True-130"></a>   filter<span class="p">(</span><span class="o">!</span><span class="kp">is.na</span><span class="p">(</span>Contra<span class="p">))</span>
<a name="True-131"></a>
<a name="True-132"></a><span class="c1"># draw scatter plot</span>
<a name="True-133"></a>scatterD3<span class="p">(</span>x <span class="o">=</span> comb<span class="o">$</span>Contra<span class="p">,</span> y <span class="o">=</span> comb<span class="o">$</span>AdolFert<span class="p">,</span> lab <span class="o">=</span> comb<span class="o">$</span>country<span class="p">,</span>
<a name="True-134"></a>          size_var <span class="o">=</span> comb<span class="o">$</span>InfantMortality<span class="p">,</span>
<a name="True-135"></a>          col_var<span class="o">=</span>comb<span class="o">$</span>worldbankincomegroup<span class="p">,</span> symbol_var <span class="o">=</span> comb<span class="o">$</span>region<span class="p">,</span>
<a name="True-136"></a>          xlab <span class="o">=</span> <span class="s">&quot;Access to contraception (%)&quot;</span><span class="p">,</span> 
<a name="True-137"></a>          ylab <span class="o">=</span> <span class="s">&quot;Adolescent fertility rate (per 1000 girls aged 15-19)&quot;</span><span class="p">,</span> 
<a name="True-138"></a>          col_lab <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
<a name="True-139"></a>          symbol_lab <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
<a name="True-140"></a>          size_lab <span class="o">=</span> <span class="s">&quot;Infant Mortality per 1000&quot;</span><span class="p">,</span>
<a name="True-141"></a>          ellipses <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> ellipses_level <span class="o">=</span> <span class="m">0.75</span><span class="p">)</span>
<a name="True-142"></a><span class="c1"># note - next step to get into a web page requires manually saving it.</span></code></pre></div>



</div>

<div class = "container">
   <div class="col-md-4">
    
        <a rel="prev" href="/blog/2016/01/30/hybrid-forecasts">
        <p>&larr; Older</p>
        <p>Better prediction intervals for time series forecasts</p>
        
        </a>
    
    </div>
    <div class="col-md-4">
    </div>
    <div class="col-md-4" style="text-align: right;">
     
        <a rel="next" href="/blog/2016/02/08/ggseas">
        <p>Newer &rarr;</p>
        <p>ggseas package for seasonal adjustment on the fly with ggplot2</p>
        
        </a>
    
      </div>
      </div>
      
      
      
</div>


   
    <div id="disqus_thread"></div>

    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'statsinthewild';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'statsinthewild';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    
    
   
			
			</div><!-- /.container -->

         

   <div class = "container footer">
			<footer>
	    		
            <p>Follow <a href = "/feed.xml">this blog with RSS</a>.  Or follow <a href = "/feed.r.xml">posts in this blog featuring R with RSS</a>.</p>
	
            <p>This blog is built with <a href = "http://jekyllrb.com/">Jekyll</a>, <a href = "http://getbootstrap.com/">Bootstrap</a>, <a href = "https://www.ruby-lang.org/en/">Ruby</a> and <a href = "https://cran.r-project.org/">R</a>.  Read my <a href="/about/acknowledgements.html">acknowledgements</a> for a little more on how.  I'm pleased to be aggregated at <a href="http://www.r-bloggers.com/">R-bloggers</a>, the one-stop shop for blog posts featuring R.</p>

            <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Peter's stats stuff</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="/" property="cc:attributionName" rel="cc:attributionURL">Peter Ellis</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.


			</footer>
    </div>



  
</body>
</html>
   




         
